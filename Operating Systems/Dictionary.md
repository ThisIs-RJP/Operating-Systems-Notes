
# System Services, System Calls, API and ABI

### Operating System
- A program that <u>acts as an intermediary</u> between a user of a computer and the computer hardware
### System Program
- Software that manages and controls the operations of a computer system

### Application Program
- All programs not associated with the OS

### Computer System Structure
- Hardware
- OS
- Application Programs
- Users
### Asymmetric Multiprocessing
- Each processor is assigned a specific task

### Symmetric Multiprocessing
- Each processor performs all tasks

### System Call
- A request made by a program to the OS for a service

# API
- Application Programming Interface

### System Call Interface
- A set of functions provided by the OS

### Kernel
- The core component of an OS that manages system resources, controls hardware, and provides essential services to programs

### Linker
- A software utility that combines multiple object files generated by a compiler into a single executable program

### Loaders
- Programs that load executable files into memory and prepare them for execution

### Relocation
- Adjusting the addresses of program code and data during the loading phase to account for the memory location where the program will be executed

### Emulation
- Mimicking the functionality of a system using another system. Allows OS to run on non-native hardware

### Performance Tuning
- Optimising the performance of a system, application or hardware component for better efficiency

### Tracing
- Collects data for a specific event
	- Tools include
		- strace - Traces system calls by a process
		- gdb - Source-level debugger
		- perf - collection of Linux performance tools
		- tcpdump - collects network packets


# File Systems

### Soft Link
- A file that is a direct link to another file in a file system
	- If this link is deleted, you have to access the target file using a different link

### Hard link
- A type of link that directly points to the inode(a data structure that stores info about a file) of another file/directory
	- If this is deleted, the file still exists, the inode is not deleted

### RAID
- Redundant Array of Independent Disks
	- A technology used to combine multiple disks into a single logical unit to improve performance and/or reliability
	- RAID protected disks/partitions are configured so that if a disk fails, the OS can continue operating without data loss or downtime

### File system
- A method used by OS to organise and store data on storage devices

### Partition
- A logical division of a storage device into separate sections

### Root partition
- Contains the OS

### Types of file systems
- ```tmpfs```- Memory based volatile, temporary, fast
- ```udev``` - Exposes underlying hardware as a file
- ```procfs``` - Kernel interface to process structures
- ```ext4``` - General purpose file systems

### Linux Proc File System
- A virtual file system that provides an interface to kernel data structures + info about system processes

### Journaling
- A technique used in file systems to improve their reliability and resilience against crashes or unexpected shutdowns. Works by keeping a log of the changes that are about to be made to the file system. Before any changes are made, they are recorded first. **Ext3/Ext4** uses journaling

### Port
- Connection for device

### Bus
- Shared direct access
## PCI
- Peripheral Component Interconnect, a standard that allows connecting devices to communicate with the CPU and other components

### Controller 
- Host adapter

### Polling
- Technique used by software to check the status of a hardware device or resource at regular intervals

### Interrupts
- Signals generated by hardware devices to notify the CPU that they require attention or have completed a task

### Direct Memory Access
- A feature of computer systems that allows certain hardware subsystems to access main system memory independently of the CPU


# Process & Threads

### Process
- A program in execution

### Threads
- The smallest unit of execution within a process
- Represents the single sequence of instructions that can be scheduled and executed by the CPU independently

# Process State
1. New
2. Ready
3. Running
4. Waiting
5. Terminated

### Process Control Block
- Information related to each process
	- State
	- Counter
	- CPU registers
	- Scheduling info
	- Memory management info
	- Account info
	- I/O status info

### Process Scheduling
- Selects among available processes for next execution on CPU core

### Context Switch
- When CPU switches to another process. Saves the state of the last process and loads the saved state of the new process

### exec()
- A system call wrapper used after fork to replace the process' memory space with a new program

### Cascading termination
- All children. grandchildren are terminated when parent has been terminated

### Zombie
- When a process is finished and called ```exit()``` but still has the PCB

### Interprocess Communication
- Two primary models of IPC
	- Shared memory
	- Message passing

### Message Passing
- Two operations
	- ```send(message)```
	- ```receive(message)```

### Direct Communication
- Must name each other
	- ```send(P, message)```
	- ```receive(Q, message)```

# Synchronisation
- The coordination of multiple processes or threads to ensure they behave correctly and avoid conflicts with accessing shared resources

### Blocking
- ```send()``` - Sender is blocked until the message is received
- ```receive()```- Receiver is blocked until a message is available

### Non-blocking send()
- ```send()```
	- Sends the message and continues

### Pipes
- A conduit allowing two processes to communicate

### Socket
- An endpoint for communication

### Multicore Programming
- Writing software that takes advantage of multiple processing units

### Parallelism
- Implies that a system can perform more than one task simultaneously

### Amdahl's Law
![[Pasted image 20240422180423.png]]


### Many to one
- A threading model where multiple user-level threads are mapped to a single kernel thread

### One to one
- A threading model where each user-level thread maps to a separate kernel thread


### Asynchronous Cancellation
- Terminates the target thread immediately

### Deferred Cancellation
- Allows the thread to periodically check if it should be cancelled

# Scheduling

### CPU Burst
- A period of time where a process executes on the CPU without interruption

### CPU scheduler
- Selects among processes in ready queue and allocated a CPU core to one of them

### CPU Scheduling
If a process
1. Switches from running to waiting state or
2. Terminates
- Then there is no choice in terms of scheduling

However
If a process
1. Switches from running to ready state
2. Switches from waiting to ready
- There is a choice

### Preemptive Scheduling
- When a process can be interrupted so that the OS can allocate resources to another process
- Can result in race conditions

### Non preemptive
- Once the CPU has been allocated a process, the CPU keeps the process until it releases it by terminating or by switching to a waiting state

### Dispatch latency
- Time taken for a dispatcher to stop one process and start another

### Throughput
- Number of processes that complete their execution per time unit

### Round Robin
- Each process gets a certain amount of CPU time before it is preempted and added to the end of the ready queue

### Priority Scheduling
- An algorithm where each process is assigned a priority and CPU allocates resources to the process with the highest priority among those that need to be executed

### Starvation
- When a process may never execute

### Ageing
- As time progresses, increase the priority of the process

### Multilevel Queue
- Separate queues for each priority

### Multiple Processor Scheduling
- Management of tasks and processes across multiple CPU cores

### Affinity
 - When the cache contents of a processor stores the memory accesses by that thread

### Soft Affinity
- OS might keep a thread running on the same processor

### Hard Affinity
- When a process/thread is explicitly bound to execute on only a specific processor/CPU's

### Event Latency
- The amount of time that elapses from when an event occurs to when it is serviced

### Race Condition
- When 2 or more processes try to access/modify the same variable in memory

### Critical Section
- A segment of code/region of a program that accesses shared resources (variables, data structures or devices) that must not be simultaneously accessed by multiple threads/processes

### Mutual Exclusion
- When a process is executing its critical section, no other process can be executing in their critical sections

### Progress
- if no process is executing in its critical section, then a process that wishes to enter its critical section cannot be postponed indefinitely

### Peterson's Algorithm
- Allows 2 processes to safely access a shared resource without interfering with each other
- Two processes share 2 variables
	- ```int turn;``` - Indicates whose turn it is to enter the critical section
	- ```boolean flag[2]``` - Indicate if a process is ready to enter the critical section
- Not guaranteed for modern architecture because to improve performance, processors and/or compilers may reorder operations that have no dependencies

### Memory Barrier
- An instruction that forces any change in memory to be made visible to other processes
- Memory guarantees a computer architecture makes to application programs

### Strongly ordered Memory Model
- Where memory modification of a processor is immediately visible to all processors

### Weakly Ordered
- Where a memory modification of a processor may not be immediately visible to all processors

### Hardware Instructions
- test_and_set
- compare_and_swap

### test_and_set
- Atomically read the current value of a memory location
- Set the memory location to a specified value (usually 1 to indicate that the resource is locked)
- Return the original value

### compare_and_swap
- Read the current value of a memory location
- If it matches the expected value, update the memory location with a new value
- Return a boolean indicating whether the operation was successful (true if the update was performed and false otherwise)

### Atomic Variables
- Atomic updates on basic data types such as integers and booleans

### Mutex Locks
- A synchronisation primitive to protect shared resources such as variables, data structures, or critical sections from simultaneously multiple threads or processes
	- A thread acquires the lock before accessing the protected resource and releases the lock when its done
	- While a thread holds the lock, other threads attempting to acquire the lock are blocked or made to wait until it is available
- ```acquire()``` - Acquire lock (or blocks it until it can)
- ```release()```
- Both are atomic

### Semaphores
- A counter (non-negative integer) that can be accessed and modified atomically
- Supports 2 operations ```wait()``` and ```signal()```
- if ```sem value > 0```, then resource is available
- ```wait()``` decrements
- ```signal()``` increments

### Binary Semaphore
- Integer values can only be 0 or 1

### Counting Semaphore
- Semaphore values can range over an unrestricted domain

### "A way to block"
- Place a process invoking the operation on an appropriate waiting queue

### "A way to wake up"
- Remove one of the processes in the waiting queue and place it in the ready queue

### Liveness
- A set of properties that a system must satisfy to ensure processes make progress

### Deadlock
- When 2 or more processes are waiting for an event that will never happen because of one of the waiting processes

### Readers-Writers Problem
- Multiple readers can reading at a time is okay
- But there can only be one writer


### First Readers-writers problem
- No reader should be kept waiting, unless a writer has already obtained permissions

### Second Readers-writers problem
- If a writer is ready to write, it writes as soon as possible IE takes priority over waiting readers

### Deadlock and the 4 conditions
- **Mutual Exclusion:** Only 1 process at a time can use a resource
- **Hold and Wait:** A process must be holding at least one resource and is waiting to acquire more that is being held by other processes
- **No Preemption:** A process must voluntarily terminate and never forcibly by the system after that process has completed the task
- **Circular Wait:** When a set of waiting processes are waiting for a resource that is being held by the resource before it

### You can prevent a deadlock if one of the conditions is invalidated
- **Mutual Exclusion:** Not required for sharable resources
- **Hold and wait:** Make sure that a process requesting resources isn't holding a resource
- **No Preemption:** If a process requests a resource that cannot be allocated to it, all resources currently being held are released
- **Circular Wait:** Impose a total ordering of all resource types

### Deadlock Avoidance Algorithm
- Dynamically checks the resource allocation state to ensure that there can never be a circular-wait condition


### Claim Edge
- Refers to a dependency relationship between two processes or threads, where one entity claims a resource before another can proceed.

### Bankers Algorithm
- An algorithm that makes sure that a process doesn't take too much resources as to not expend all for the rest of the processes that may need to use it

### Memory Management

### Protection
- Ensures that a process can only access the addresses in its address space

### Address Binding
- Making sure that a program knows where everything is located in memory so that it can run smoothly and efficiently

### Logical Vs Physical Address 
- Logical - generated by the CPU (aka virtual address)
- Physical Address - Address seen by the memory unit

### Contiguous Allocation
- Memory Allocation Technique used by OS to assign memory to programs and data in a contiguous matter

### Hole
- Block of available memory

### Dynamic Storage-Allocation Problem
- First fit - Allocate first hole that is big enough
- Best fit 0 - Allocate the smallest hole that is big enough (must search entire list)
- Worst fit - Allocate the largest hole (must search entire list)

### External Fragmentation
- Total memory space may exist, but it is not contiguous

### Internal Fragmentation
- Allocated memory may be slightly larger than requested

### Paging
- Allows physical memory to be divided into fixed-size blocks called pages

### Effective Access Time
- Total time taken for a computer to respond to a memory access request

### Swapping
- Swapping processes temporarily out of memory to a backing store, which is then brought back into memory for continued execution if space is needed

### Thrashing
- Where virtual memory is overused
